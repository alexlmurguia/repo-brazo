% Este código se utiliza para reescribir ecuaciones de matlab en formato de
% python

clear, clc
s = 'pi + asin((sy*cos(th1)*sin(th4) - sx*sin(th1)*sin(th4) + sz*cos(th2)*cos(th4)*sin(th3) + sz*cos(th3)*cos(th4)*sin(th2) + sx*cos(th1)*cos(th2)*cos(th3)*cos(th4) + sy*cos(th2)*cos(th3)*cos(th4)*sin(th1) - sx*cos(th1)*cos(th4)*sin(th2)*sin(th3) - sy*cos(th4)*sin(th1)*sin(th2)*sin(th3))/(nx^2*cos(th1)^2*cos(th2)^2*cos(th3)^2*cos(th4)^2 - 2*nx^2*cos(th1)^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th2)*sin(th3) + nx^2*cos(th1)^2*cos(th4)^2*sin(th2)^2*sin(th3)^2 - 2*nx^2*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th4) + 2*nx^2*cos(th1)*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th4) + nx^2*sin(th1)^2*sin(th4)^2 + 2*nx*ny*cos(th1)^2*cos(th2)*cos(th3)*cos(th4)*sin(th4) - 2*nx*ny*cos(th1)^2*cos(th4)*sin(th2)*sin(th3)*sin(th4) + 2*nx*ny*cos(th1)*cos(th2)^2*cos(th3)^2*cos(th4)^2*sin(th1) - 4*nx*ny*cos(th1)*cos(th2)*cos(th3)*cos(th4)^2*sin(th1)*sin(th2)*sin(th3) + 2*nx*ny*cos(th1)*cos(th4)^2*sin(th1)*sin(th2)^2*sin(th3)^2 - 2*nx*ny*cos(th1)*sin(th1)*sin(th4)^2 - 2*nx*ny*cos(th2)*cos(th3)*cos(th4)*sin(th1)^2*sin(th4) + 2*nx*ny*cos(th4)*sin(th1)^2*sin(th2)*sin(th3)*sin(th4) + 2*nx*nz*cos(th1)*cos(th2)^2*cos(th3)*cos(th4)^2*sin(th3) + 2*nx*nz*cos(th1)*cos(th2)*cos(th3)^2*cos(th4)^2*sin(th2) - 2*nx*nz*cos(th1)*cos(th2)*cos(th4)^2*sin(th2)*sin(th3)^2 - 2*nx*nz*cos(th1)*cos(th3)*cos(th4)^2*sin(th2)^2*sin(th3) - 2*nx*nz*cos(th2)*cos(th4)*sin(th1)*sin(th3)*sin(th4) - 2*nx*nz*cos(th3)*cos(th4)*sin(th1)*sin(th2)*sin(th4) + ny^2*cos(th1)^2*sin(th4)^2 + 2*ny^2*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th4) - 2*ny^2*cos(th1)*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th4) + ny^2*cos(th2)^2*cos(th3)^2*cos(th4)^2*sin(th1)^2 - 2*ny^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th1)^2*sin(th2)*sin(th3) + ny^2*cos(th4)^2*sin(th1)^2*sin(th2)^2*sin(th3)^2 + 2*ny*nz*cos(th1)*cos(th2)*cos(th4)*sin(th3)*sin(th4) + 2*ny*nz*cos(th1)*cos(th3)*cos(th4)*sin(th2)*sin(th4) + 2*ny*nz*cos(th2)^2*cos(th3)*cos(th4)^2*sin(th1)*sin(th3) + 2*ny*nz*cos(th2)*cos(th3)^2*cos(th4)^2*sin(th1)*sin(th2) - 2*ny*nz*cos(th2)*cos(th4)^2*sin(th1)*sin(th2)*sin(th3)^2 - 2*ny*nz*cos(th3)*cos(th4)^2*sin(th1)*sin(th2)^2*sin(th3) + nz^2*cos(th2)^2*cos(th4)^2*sin(th3)^2 + 2*nz^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th2)*sin(th3) + nz^2*cos(th3)^2*cos(th4)^2*sin(th2)^2 + sx^2*cos(th1)^2*cos(th2)^2*cos(th3)^2*cos(th4)^2 - 2*sx^2*cos(th1)^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th2)*sin(th3) + sx^2*cos(th1)^2*cos(th4)^2*sin(th2)^2*sin(th3)^2 - 2*sx^2*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th4) + 2*sx^2*cos(th1)*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th4) + sx^2*sin(th1)^2*sin(th4)^2 + 2*sx*sy*cos(th1)^2*cos(th2)*cos(th3)*cos(th4)*sin(th4) - 2*sx*sy*cos(th1)^2*cos(th4)*sin(th2)*sin(th3)*sin(th4) + 2*sx*sy*cos(th1)*cos(th2)^2*cos(th3)^2*cos(th4)^2*sin(th1) - 4*sx*sy*cos(th1)*cos(th2)*cos(th3)*cos(th4)^2*sin(th1)*sin(th2)*sin(th3) + 2*sx*sy*cos(th1)*cos(th4)^2*sin(th1)*sin(th2)^2*sin(th3)^2 - 2*sx*sy*cos(th1)*sin(th1)*sin(th4)^2 - 2*sx*sy*cos(th2)*cos(th3)*cos(th4)*sin(th1)^2*sin(th4) + 2*sx*sy*cos(th4)*sin(th1)^2*sin(th2)*sin(th3)*sin(th4) + 2*sx*sz*cos(th1)*cos(th2)^2*cos(th3)*cos(th4)^2*sin(th3) + 2*sx*sz*cos(th1)*cos(th2)*cos(th3)^2*cos(th4)^2*sin(th2) - 2*sx*sz*cos(th1)*cos(th2)*cos(th4)^2*sin(th2)*sin(th3)^2 - 2*sx*sz*cos(th1)*cos(th3)*cos(th4)^2*sin(th2)^2*sin(th3) - 2*sx*sz*cos(th2)*cos(th4)*sin(th1)*sin(th3)*sin(th4) - 2*sx*sz*cos(th3)*cos(th4)*sin(th1)*sin(th2)*sin(th4) + sy^2*cos(th1)^2*sin(th4)^2 + 2*sy^2*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th4) - 2*sy^2*cos(th1)*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th4) + sy^2*cos(th2)^2*cos(th3)^2*cos(th4)^2*sin(th1)^2 - 2*sy^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th1)^2*sin(th2)*sin(th3) + sy^2*cos(th4)^2*sin(th1)^2*sin(th2)^2*sin(th3)^2 + 2*sy*sz*cos(th1)*cos(th2)*cos(th4)*sin(th3)*sin(th4) + 2*sy*sz*cos(th1)*cos(th3)*cos(th4)*sin(th2)*sin(th4) + 2*sy*sz*cos(th2)^2*cos(th3)*cos(th4)^2*sin(th1)*sin(th3) + 2*sy*sz*cos(th2)*cos(th3)^2*cos(th4)^2*sin(th1)*sin(th2) - 2*sy*sz*cos(th2)*cos(th4)^2*sin(th1)*sin(th2)*sin(th3)^2 - 2*sy*sz*cos(th3)*cos(th4)^2*sin(th1)*sin(th2)^2*sin(th3) + sz^2*cos(th2)^2*cos(th4)^2*sin(th3)^2 + 2*sz^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th2)*sin(th3) + sz^2*cos(th3)^2*cos(th4)^2*sin(th2)^2)^(1/2))'
s = strrep(s,'^','**');
s = strrep(s,'i','j');
s = strrep(s,'th1','q1');
s = strrep(s,'th2','q2');
s = strrep(s,'th3','q3');
s = strrep(s,'th4','q4');
s = strrep(s,'atan','cmath.atan');
s = strrep(s,'sjn','cmath.sin');
s = strrep(s,'acmath.sin','cmath.asin');
s = strrep(s,'cos','cmath.cos');
s = strrep(s,'acmath.cos','cmath.acos');
s = strrep(s,'log','cmath.log');
s = strrep(s,'exp','cmath.exp');
s = strrep(s,'pj','math.pi')

f = 'L1 + L4*cos(th2 + th3) + L2*sin(th2) - (L5*sin(th2 + th3)*sin(th4 + th5))/2 + L5*cos(th2 + th3)*cos(th5) + (L5*sin(th4 - th5)*sin(th2 + th3))/2'
f = strrep(f,'^','**');
f = strrep(f,'sin','np.sin');
f = strrep(f,'cos','np.cos')

% q1 =
%  
%  -log(-(L3*1i - (L3^2 - dx^2 - dy^2)^(1/2)*1i)/(dx - dy*1i))*1i
%  -log(-(L3*1i + (L3^2 - dx^2 - dy^2)^(1/2)*1i)/(dx - dy*1i))*1i
%  
% q2 =
%  
%  -log((exp(-th1*1i)*(dx*dy*2i + 4*L1^2*exp(th1*2i) + 4*L2^2*exp(th1*2i) - 4*L4^2*exp(th1*2i) + 2*dx^2*exp(th1*2i) + dx^2*exp(th1*4i) + 2*dy^2*exp(th1*2i) - dy^2*exp(th1*4i) + 4*dz^2*exp(th1*2i) + dx^2 - dy^2 + ((dx*dy*2i + 4*L1^2*exp(th1*2i) + 4*L2^2*exp(th1*2i) - 4*L4^2*exp(th1*2i) + 2*dx^2*exp(th1*2i) + dx^2*exp(th1*4i) + 2*dy^2*exp(th1*2i) - dy^2*exp(th1*4i) + 4*dz^2*exp(th1*2i) + dx^2 - dy^2 - 8*L1*dz*exp(th1*2i) - dx*dy*exp(th1*4i)*2i)^2 - 16*L2^2*exp(th1*2i)*(dx + dy*1i - L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i + dz*exp(th1*1i)*2i)*(dx + dy*1i + L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i - dz*exp(th1*1i)*2i))^(1/2) - 8*L1*dz*exp(th1*2i) - dx*dy*exp(th1*4i)*2i))/(4*L2*(dx + dy*1i + L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i - dz*exp(th1*1i)*2i)))*1i
%  -log((exp(-th1*1i)*(dx*dy*2i + 4*L1^2*exp(th1*2i) + 4*L2^2*exp(th1*2i) - 4*L4^2*exp(th1*2i) + 2*dx^2*exp(th1*2i) + dx^2*exp(th1*4i) + 2*dy^2*exp(th1*2i) - dy^2*exp(th1*4i) + 4*dz^2*exp(th1*2i) + dx^2 - dy^2 - ((dx*dy*2i + 4*L1^2*exp(th1*2i) + 4*L2^2*exp(th1*2i) - 4*L4^2*exp(th1*2i) + 2*dx^2*exp(th1*2i) + dx^2*exp(th1*4i) + 2*dy^2*exp(th1*2i) - dy^2*exp(th1*4i) + 4*dz^2*exp(th1*2i) + dx^2 - dy^2 - 8*L1*dz*exp(th1*2i) - dx*dy*exp(th1*4i)*2i)^2 - 16*L2^2*exp(th1*2i)*(dx + dy*1i - L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i + dz*exp(th1*1i)*2i)*(dx + dy*1i + L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i - dz*exp(th1*1i)*2i))^(1/2) - 8*L1*dz*exp(th1*2i) - dx*dy*exp(th1*4i)*2i))/(4*L2*(dx + dy*1i + L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i - dz*exp(th1*1i)*2i)))*1i
%  
% q3_1 =
%  
%  2*pi + log((exp(-th1*1i)*(dx*dy*2i + 4*L1^2*exp(th1*2i) + 4*L2^2*exp(th1*2i) - 4*L4^2*exp(th1*2i) + 2*dx^2*exp(th1*2i) + dx^2*exp(th1*4i) + 2*dy^2*exp(th1*2i) - dy^2*exp(th1*4i) + 4*dz^2*exp(th1*2i) + dx^2 - dy^2 + ((dx*dy*2i + 4*L1^2*exp(th1*2i) + 4*L2^2*exp(th1*2i) - 4*L4^2*exp(th1*2i) + 2*dx^2*exp(th1*2i) + dx^2*exp(th1*4i) + 2*dy^2*exp(th1*2i) - dy^2*exp(th1*4i) + 4*dz^2*exp(th1*2i) + dx^2 - dy^2 - 8*L1*dz*exp(th1*2i) - dx*dy*exp(th1*4i)*2i)^2 - 16*L2^2*exp(th1*2i)*(dx + dy*1i - L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i + dz*exp(th1*1i)*2i)*(dx + dy*1i + L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i - dz*exp(th1*1i)*2i))^(1/2) - 8*L1*dz*exp(th1*2i) - dx*dy*exp(th1*4i)*2i))/(4*L2*(dx + dy*1i + L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i - dz*exp(th1*1i)*2i)))*1i - acos((dz - L1 + L2*sin(log((exp(-th1*1i)*(dx*dy*2i + 4*L1^2*exp(th1*2i) + 4*L2^2*exp(th1*2i) - 4*L4^2*exp(th1*2i) + 2*dx^2*exp(th1*2i) + dx^2*exp(th1*4i) + 2*dy^2*exp(th1*2i) - dy^2*exp(th1*4i) + 4*dz^2*exp(th1*2i) + dx^2 - dy^2 + ((dx*dy*2i + 4*L1^2*exp(th1*2i) + 4*L2^2*exp(th1*2i) - 4*L4^2*exp(th1*2i) + 2*dx^2*exp(th1*2i) + dx^2*exp(th1*4i) + 2*dy^2*exp(th1*2i) - dy^2*exp(th1*4i) + 4*dz^2*exp(th1*2i) + dx^2 - dy^2 - 8*L1*dz*exp(th1*2i) - dx*dy*exp(th1*4i)*2i)^2 - 16*L2^2*exp(th1*2i)*(dx + dy*1i - L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i + dz*exp(th1*1i)*2i)*(dx + dy*1i + L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i - dz*exp(th1*1i)*2i))^(1/2) - 8*L1*dz*exp(th1*2i) - dx*dy*exp(th1*4i)*2i))/(4*L2*(dx + dy*1i + L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i - dz*exp(th1*1i)*2i)))*1i))/L4)
%         log((exp(-th1*1i)*(dx*dy*2i + 4*L1^2*exp(th1*2i) + 4*L2^2*exp(th1*2i) - 4*L4^2*exp(th1*2i) + 2*dx^2*exp(th1*2i) + dx^2*exp(th1*4i) + 2*dy^2*exp(th1*2i) - dy^2*exp(th1*4i) + 4*dz^2*exp(th1*2i) + dx^2 - dy^2 + ((dx*dy*2i + 4*L1^2*exp(th1*2i) + 4*L2^2*exp(th1*2i) - 4*L4^2*exp(th1*2i) + 2*dx^2*exp(th1*2i) + dx^2*exp(th1*4i) + 2*dy^2*exp(th1*2i) - dy^2*exp(th1*4i) + 4*dz^2*exp(th1*2i) + dx^2 - dy^2 - 8*L1*dz*exp(th1*2i) - dx*dy*exp(th1*4i)*2i)^2 - 16*L2^2*exp(th1*2i)*(dx + dy*1i - L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i + dz*exp(th1*1i)*2i)*(dx + dy*1i + L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i - dz*exp(th1*1i)*2i))^(1/2) - 8*L1*dz*exp(th1*2i) - dx*dy*exp(th1*4i)*2i))/(4*L2*(dx + dy*1i + L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i - dz*exp(th1*1i)*2i)))*1i + acos((dz - L1 + L2*sin(log((exp(-th1*1i)*(dx*dy*2i + 4*L1^2*exp(th1*2i) + 4*L2^2*exp(th1*2i) - 4*L4^2*exp(th1*2i) + 2*dx^2*exp(th1*2i) + dx^2*exp(th1*4i) + 2*dy^2*exp(th1*2i) - dy^2*exp(th1*4i) + 4*dz^2*exp(th1*2i) + dx^2 - dy^2 + ((dx*dy*2i + 4*L1^2*exp(th1*2i) + 4*L2^2*exp(th1*2i) - 4*L4^2*exp(th1*2i) + 2*dx^2*exp(th1*2i) + dx^2*exp(th1*4i) + 2*dy^2*exp(th1*2i) - dy^2*exp(th1*4i) + 4*dz^2*exp(th1*2i) + dx^2 - dy^2 - 8*L1*dz*exp(th1*2i) - dx*dy*exp(th1*4i)*2i)^2 - 16*L2^2*exp(th1*2i)*(dx + dy*1i - L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i + dz*exp(th1*1i)*2i)*(dx + dy*1i + L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i - dz*exp(th1*1i)*2i))^(1/2) - 8*L1*dz*exp(th1*2i) - dx*dy*exp(th1*4i)*2i))/(4*L2*(dx + dy*1i + L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i - dz*exp(th1*1i)*2i)))*1i))/L4)
%  
%  
% q3_2 =
%  
%  2*pi + log((exp(-th1*1i)*(dx*dy*2i + 4*L1^2*exp(th1*2i) + 4*L2^2*exp(th1*2i) - 4*L4^2*exp(th1*2i) + 2*dx^2*exp(th1*2i) + dx^2*exp(th1*4i) + 2*dy^2*exp(th1*2i) - dy^2*exp(th1*4i) + 4*dz^2*exp(th1*2i) + dx^2 - dy^2 - ((dx*dy*2i + 4*L1^2*exp(th1*2i) + 4*L2^2*exp(th1*2i) - 4*L4^2*exp(th1*2i) + 2*dx^2*exp(th1*2i) + dx^2*exp(th1*4i) + 2*dy^2*exp(th1*2i) - dy^2*exp(th1*4i) + 4*dz^2*exp(th1*2i) + dx^2 - dy^2 - 8*L1*dz*exp(th1*2i) - dx*dy*exp(th1*4i)*2i)^2 - 16*L2^2*exp(th1*2i)*(dx + dy*1i - L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i + dz*exp(th1*1i)*2i)*(dx + dy*1i + L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i - dz*exp(th1*1i)*2i))^(1/2) - 8*L1*dz*exp(th1*2i) - dx*dy*exp(th1*4i)*2i))/(4*L2*(dx + dy*1i + L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i - dz*exp(th1*1i)*2i)))*1i - acos((dz - L1 + L2*sin(log((exp(-th1*1i)*(dx*dy*2i + 4*L1^2*exp(th1*2i) + 4*L2^2*exp(th1*2i) - 4*L4^2*exp(th1*2i) + 2*dx^2*exp(th1*2i) + dx^2*exp(th1*4i) + 2*dy^2*exp(th1*2i) - dy^2*exp(th1*4i) + 4*dz^2*exp(th1*2i) + dx^2 - dy^2 - ((dx*dy*2i + 4*L1^2*exp(th1*2i) + 4*L2^2*exp(th1*2i) - 4*L4^2*exp(th1*2i) + 2*dx^2*exp(th1*2i) + dx^2*exp(th1*4i) + 2*dy^2*exp(th1*2i) - dy^2*exp(th1*4i) + 4*dz^2*exp(th1*2i) + dx^2 - dy^2 - 8*L1*dz*exp(th1*2i) - dx*dy*exp(th1*4i)*2i)^2 - 16*L2^2*exp(th1*2i)*(dx + dy*1i - L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i + dz*exp(th1*1i)*2i)*(dx + dy*1i + L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i - dz*exp(th1*1i)*2i))^(1/2) - 8*L1*dz*exp(th1*2i) - dx*dy*exp(th1*4i)*2i))/(4*L2*(dx + dy*1i + L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i - dz*exp(th1*1i)*2i)))*1i))/L4)
%         log((exp(-th1*1i)*(dx*dy*2i + 4*L1^2*exp(th1*2i) + 4*L2^2*exp(th1*2i) - 4*L4^2*exp(th1*2i) + 2*dx^2*exp(th1*2i) + dx^2*exp(th1*4i) + 2*dy^2*exp(th1*2i) - dy^2*exp(th1*4i) + 4*dz^2*exp(th1*2i) + dx^2 - dy^2 - ((dx*dy*2i + 4*L1^2*exp(th1*2i) + 4*L2^2*exp(th1*2i) - 4*L4^2*exp(th1*2i) + 2*dx^2*exp(th1*2i) + dx^2*exp(th1*4i) + 2*dy^2*exp(th1*2i) - dy^2*exp(th1*4i) + 4*dz^2*exp(th1*2i) + dx^2 - dy^2 - 8*L1*dz*exp(th1*2i) - dx*dy*exp(th1*4i)*2i)^2 - 16*L2^2*exp(th1*2i)*(dx + dy*1i - L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i + dz*exp(th1*1i)*2i)*(dx + dy*1i + L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i - dz*exp(th1*1i)*2i))^(1/2) - 8*L1*dz*exp(th1*2i) - dx*dy*exp(th1*4i)*2i))/(4*L2*(dx + dy*1i + L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i - dz*exp(th1*1i)*2i)))*1i + acos((dz - L1 + L2*sin(log((exp(-th1*1i)*(dx*dy*2i + 4*L1^2*exp(th1*2i) + 4*L2^2*exp(th1*2i) - 4*L4^2*exp(th1*2i) + 2*dx^2*exp(th1*2i) + dx^2*exp(th1*4i) + 2*dy^2*exp(th1*2i) - dy^2*exp(th1*4i) + 4*dz^2*exp(th1*2i) + dx^2 - dy^2 - ((dx*dy*2i + 4*L1^2*exp(th1*2i) + 4*L2^2*exp(th1*2i) - 4*L4^2*exp(th1*2i) + 2*dx^2*exp(th1*2i) + dx^2*exp(th1*4i) + 2*dy^2*exp(th1*2i) - dy^2*exp(th1*4i) + 4*dz^2*exp(th1*2i) + dx^2 - dy^2 - 8*L1*dz*exp(th1*2i) - dx*dy*exp(th1*4i)*2i)^2 - 16*L2^2*exp(th1*2i)*(dx + dy*1i - L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i + dz*exp(th1*1i)*2i)*(dx + dy*1i + L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i - dz*exp(th1*1i)*2i))^(1/2) - 8*L1*dz*exp(th1*2i) - dx*dy*exp(th1*4i)*2i))/(4*L2*(dx + dy*1i + L1*exp(th1*1i)*2i + dx*exp(th1*2i) - dy*exp(th1*2i)*1i - dz*exp(th1*1i)*2i)))*1i))/L4)
% 
% q4 =
%  
%   -log((ax*ay*2i + 2*ax^2*exp(th1*2i) + ax^2*exp(th1*4i) + 2*ay^2*exp(th1*2i) - ay^2*exp(th1*4i) - 4*az^2*exp(th1*2i) + ax^2 - ay^2 - ax*ay*exp(th1*4i)*2i + ax*az*exp(th1*1i)*4i + ax*az*exp(th1*3i)*4i - 4*ay*az*exp(th1*1i) + 4*ay*az*exp(th1*3i) - 2*ax^2*exp(th2*2i)*exp(th3*2i) + ax^2*exp(th2*4i)*exp(th3*4i) + 2*ay^2*exp(th2*2i)*exp(th3*2i) - ay^2*exp(th2*4i)*exp(th3*4i) - ax*ay*exp(th2*2i)*exp(th3*2i)*4i + ax*ay*exp(th2*4i)*exp(th3*4i)*2i + 12*ax^2*exp(th1*2i)*exp(th2*2i)*exp(th3*2i) - 2*ax^2*exp(th2*2i)*exp(th1*4i)*exp(th3*2i) + 2*ax^2*exp(th1*2i)*exp(th2*4i)*exp(th3*4i) + ax^2*exp(th1*4i)*exp(th2*4i)*exp(th3*4i) + 12*ay^2*exp(th1*2i)*exp(th2*2i)*exp(th3*2i) + 2*ay^2*exp(th2*2i)*exp(th1*4i)*exp(th3*2i) + 2*ay^2*exp(th1*2i)*exp(th2*4i)*exp(th3*4i) - ay^2*exp(th1*4i)*exp(th2*4i)*exp(th3*4i) + 8*az^2*exp(th1*2i)*exp(th2*2i)*exp(th3*2i) - 4*az^2*exp(th1*2i)*exp(th2*4i)*exp(th3*4i) + ax*ay*exp(th2*2i)*exp(th1*4i)*exp(th3*2i)*4i - ax*ay*exp(th1*4i)*exp(th2*4i)*exp(th3*4i)*2i - ax*az*exp(th1*1i)*exp(th2*4i)*exp(th3*4i)*4i - ax*az*exp(th1*3i)*exp(th2*4i)*exp(th3*4i)*4i + 4*ay*az*exp(th1*1i)*exp(th2*4i)*exp(th3*4i) - 4*ay*az*exp(th1*3i)*exp(th2*4i)*exp(th3*4i))^(1/2)/(ax + ay*1i + ax*exp(th1*2i) - ay*exp(th1*2i)*1i + az*exp(th1*1i)*2i - 2*ax*exp(th2*1i)*exp(th3*1i) + ax*exp(th2*2i)*exp(th3*2i) - ay*exp(th2*1i)*exp(th3*1i)*2i + ay*exp(th2*2i)*exp(th3*2i)*1i + 2*ax*exp(th1*2i)*exp(th2*1i)*exp(th3*1i) + ax*exp(th1*2i)*exp(th2*2i)*exp(th3*2i) - ay*exp(th1*2i)*exp(th2*1i)*exp(th3*1i)*2i - ay*exp(th1*2i)*exp(th2*2i)*exp(th3*2i)*1i - az*exp(th1*1i)*exp(th2*2i)*exp(th3*2i)*2i))*1i
%  -log(-(ax*ay*2i + 2*ax^2*exp(th1*2i) + ax^2*exp(th1*4i) + 2*ay^2*exp(th1*2i) - ay^2*exp(th1*4i) - 4*az^2*exp(th1*2i) + ax^2 - ay^2 - ax*ay*exp(th1*4i)*2i + ax*az*exp(th1*1i)*4i + ax*az*exp(th1*3i)*4i - 4*ay*az*exp(th1*1i) + 4*ay*az*exp(th1*3i) - 2*ax^2*exp(th2*2i)*exp(th3*2i) + ax^2*exp(th2*4i)*exp(th3*4i) + 2*ay^2*exp(th2*2i)*exp(th3*2i) - ay^2*exp(th2*4i)*exp(th3*4i) - ax*ay*exp(th2*2i)*exp(th3*2i)*4i + ax*ay*exp(th2*4i)*exp(th3*4i)*2i + 12*ax^2*exp(th1*2i)*exp(th2*2i)*exp(th3*2i) - 2*ax^2*exp(th2*2i)*exp(th1*4i)*exp(th3*2i) + 2*ax^2*exp(th1*2i)*exp(th2*4i)*exp(th3*4i) + ax^2*exp(th1*4i)*exp(th2*4i)*exp(th3*4i) + 12*ay^2*exp(th1*2i)*exp(th2*2i)*exp(th3*2i) + 2*ay^2*exp(th2*2i)*exp(th1*4i)*exp(th3*2i) + 2*ay^2*exp(th1*2i)*exp(th2*4i)*exp(th3*4i) - ay^2*exp(th1*4i)*exp(th2*4i)*exp(th3*4i) + 8*az^2*exp(th1*2i)*exp(th2*2i)*exp(th3*2i) - 4*az^2*exp(th1*2i)*exp(th2*4i)*exp(th3*4i) + ax*ay*exp(th2*2i)*exp(th1*4i)*exp(th3*2i)*4i - ax*ay*exp(th1*4i)*exp(th2*4i)*exp(th3*4i)*2i - ax*az*exp(th1*1i)*exp(th2*4i)*exp(th3*4i)*4i - ax*az*exp(th1*3i)*exp(th2*4i)*exp(th3*4i)*4i + 4*ay*az*exp(th1*1i)*exp(th2*4i)*exp(th3*4i) - 4*ay*az*exp(th1*3i)*exp(th2*4i)*exp(th3*4i))^(1/2)/(ax + ay*1i + ax*exp(th1*2i) - ay*exp(th1*2i)*1i + az*exp(th1*1i)*2i - 2*ax*exp(th2*1i)*exp(th3*1i) + ax*exp(th2*2i)*exp(th3*2i) - ay*exp(th2*1i)*exp(th3*1i)*2i + ay*exp(th2*2i)*exp(th3*2i)*1i + 2*ax*exp(th1*2i)*exp(th2*1i)*exp(th3*1i) + ax*exp(th1*2i)*exp(th2*2i)*exp(th3*2i) - ay*exp(th1*2i)*exp(th2*1i)*exp(th3*1i)*2i - ay*exp(th1*2i)*exp(th2*2i)*exp(th3*2i)*1i - az*exp(th1*1i)*exp(th2*2i)*exp(th3*2i)*2i))*1i
% 
% q5 =
%  
%   acos((ny^2*cos(th1)^2*sin(th4)^2 + sy^2*cos(th1)^2*sin(th4)^2 + nx^2*sin(th1)^2*sin(th4)^2 + sx^2*sin(th1)^2*sin(th4)^2 + nz^2*cos(th2)^2*cos(th4)^2*sin(th3)^2 + nz^2*cos(th3)^2*cos(th4)^2*sin(th2)^2 + sz^2*cos(th2)^2*cos(th4)^2*sin(th3)^2 + sz^2*cos(th3)^2*cos(th4)^2*sin(th2)^2 + nx^2*cos(th1)^2*cos(th2)^2*cos(th3)^2*cos(th4)^2 + sx^2*cos(th1)^2*cos(th2)^2*cos(th3)^2*cos(th4)^2 + ny^2*cos(th2)^2*cos(th3)^2*cos(th4)^2*sin(th1)^2 + sy^2*cos(th2)^2*cos(th3)^2*cos(th4)^2*sin(th1)^2 + nx^2*cos(th1)^2*cos(th4)^2*sin(th2)^2*sin(th3)^2 + sx^2*cos(th1)^2*cos(th4)^2*sin(th2)^2*sin(th3)^2 + ny^2*cos(th4)^2*sin(th1)^2*sin(th2)^2*sin(th3)^2 + sy^2*cos(th4)^2*sin(th1)^2*sin(th2)^2*sin(th3)^2 - 2*nx*ny*cos(th1)*sin(th1)*sin(th4)^2 - 2*sx*sy*cos(th1)*sin(th1)*sin(th4)^2 + 2*nz^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th2)*sin(th3) + 2*sz^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th2)*sin(th3) - 2*nx*ny*cos(th1)^2*cos(th4)*sin(th2)*sin(th3)*sin(th4) - 2*sx*sy*cos(th1)^2*cos(th4)*sin(th2)*sin(th3)*sin(th4) + 2*nx*ny*cos(th4)*sin(th1)^2*sin(th2)*sin(th3)*sin(th4) - 2*nx^2*cos(th1)^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th2)*sin(th3) + 2*sx*sy*cos(th4)*sin(th1)^2*sin(th2)*sin(th3)*sin(th4) - 2*sx^2*cos(th1)^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th2)*sin(th3) - 2*ny^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th1)^2*sin(th2)*sin(th3) - 2*sy^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th1)^2*sin(th2)*sin(th3) + 2*nx*nz*cos(th1)*cos(th2)*cos(th3)^2*cos(th4)^2*sin(th2) + 2*nx*nz*cos(th1)*cos(th2)^2*cos(th3)*cos(th4)^2*sin(th3) + 2*sx*sz*cos(th1)*cos(th2)*cos(th3)^2*cos(th4)^2*sin(th2) + 2*sx*sz*cos(th1)*cos(th2)^2*cos(th3)*cos(th4)^2*sin(th3) - 2*nx*nz*cos(th1)*cos(th2)*cos(th4)^2*sin(th2)*sin(th3)^2 - 2*nx*nz*cos(th1)*cos(th3)*cos(th4)^2*sin(th2)^2*sin(th3) + 2*ny*nz*cos(th2)*cos(th3)^2*cos(th4)^2*sin(th1)*sin(th2) + 2*ny*nz*cos(th2)^2*cos(th3)*cos(th4)^2*sin(th1)*sin(th3) - 2*nx^2*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th4) + 2*ny^2*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th4) - 2*sx*sz*cos(th1)*cos(th2)*cos(th4)^2*sin(th2)*sin(th3)^2 - 2*sx*sz*cos(th1)*cos(th3)*cos(th4)^2*sin(th2)^2*sin(th3) + 2*sy*sz*cos(th2)*cos(th3)^2*cos(th4)^2*sin(th1)*sin(th2) + 2*sy*sz*cos(th2)^2*cos(th3)*cos(th4)^2*sin(th1)*sin(th3) - 2*sx^2*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th4) + 2*sy^2*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th4) - 2*ny*nz*cos(th2)*cos(th4)^2*sin(th1)*sin(th2)*sin(th3)^2 - 2*ny*nz*cos(th3)*cos(th4)^2*sin(th1)*sin(th2)^2*sin(th3) - 2*sy*sz*cos(th2)*cos(th4)^2*sin(th1)*sin(th2)*sin(th3)^2 - 2*sy*sz*cos(th3)*cos(th4)^2*sin(th1)*sin(th2)^2*sin(th3) + 2*nx^2*cos(th1)*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th4) - 2*ny^2*cos(th1)*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th4) + 2*sx^2*cos(th1)*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th4) - 2*sy^2*cos(th1)*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th4) + 2*ny*nz*cos(th1)*cos(th2)*cos(th4)*sin(th3)*sin(th4) + 2*ny*nz*cos(th1)*cos(th3)*cos(th4)*sin(th2)*sin(th4) + 2*sy*sz*cos(th1)*cos(th2)*cos(th4)*sin(th3)*sin(th4) + 2*sy*sz*cos(th1)*cos(th3)*cos(th4)*sin(th2)*sin(th4) + 2*nx*ny*cos(th1)*cos(th2)^2*cos(th3)^2*cos(th4)^2*sin(th1) - 2*nx*nz*cos(th2)*cos(th4)*sin(th1)*sin(th3)*sin(th4) - 2*nx*nz*cos(th3)*cos(th4)*sin(th1)*sin(th2)*sin(th4) + 2*sx*sy*cos(th1)*cos(th2)^2*cos(th3)^2*cos(th4)^2*sin(th1) - 2*sx*sz*cos(th2)*cos(th4)*sin(th1)*sin(th3)*sin(th4) - 2*sx*sz*cos(th3)*cos(th4)*sin(th1)*sin(th2)*sin(th4) + 2*nx*ny*cos(th1)*cos(th4)^2*sin(th1)*sin(th2)^2*sin(th3)^2 + 2*sx*sy*cos(th1)*cos(th4)^2*sin(th1)*sin(th2)^2*sin(th3)^2 + 2*nx*ny*cos(th1)^2*cos(th2)*cos(th3)*cos(th4)*sin(th4) + 2*sx*sy*cos(th1)^2*cos(th2)*cos(th3)*cos(th4)*sin(th4) - 2*nx*ny*cos(th2)*cos(th3)*cos(th4)*sin(th1)^2*sin(th4) - 2*sx*sy*cos(th2)*cos(th3)*cos(th4)*sin(th1)^2*sin(th4) - 4*nx*ny*cos(th1)*cos(th2)*cos(th3)*cos(th4)^2*sin(th1)*sin(th2)*sin(th3) - 4*sx*sy*cos(th1)*cos(th2)*cos(th3)*cos(th4)^2*sin(th1)*sin(th2)*sin(th3))^(1/2))
%  -acos((ny^2*cos(th1)^2*sin(th4)^2 + sy^2*cos(th1)^2*sin(th4)^2 + nx^2*sin(th1)^2*sin(th4)^2 + sx^2*sin(th1)^2*sin(th4)^2 + nz^2*cos(th2)^2*cos(th4)^2*sin(th3)^2 + nz^2*cos(th3)^2*cos(th4)^2*sin(th2)^2 + sz^2*cos(th2)^2*cos(th4)^2*sin(th3)^2 + sz^2*cos(th3)^2*cos(th4)^2*sin(th2)^2 + nx^2*cos(th1)^2*cos(th2)^2*cos(th3)^2*cos(th4)^2 + sx^2*cos(th1)^2*cos(th2)^2*cos(th3)^2*cos(th4)^2 + ny^2*cos(th2)^2*cos(th3)^2*cos(th4)^2*sin(th1)^2 + sy^2*cos(th2)^2*cos(th3)^2*cos(th4)^2*sin(th1)^2 + nx^2*cos(th1)^2*cos(th4)^2*sin(th2)^2*sin(th3)^2 + sx^2*cos(th1)^2*cos(th4)^2*sin(th2)^2*sin(th3)^2 + ny^2*cos(th4)^2*sin(th1)^2*sin(th2)^2*sin(th3)^2 + sy^2*cos(th4)^2*sin(th1)^2*sin(th2)^2*sin(th3)^2 - 2*nx*ny*cos(th1)*sin(th1)*sin(th4)^2 - 2*sx*sy*cos(th1)*sin(th1)*sin(th4)^2 + 2*nz^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th2)*sin(th3) + 2*sz^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th2)*sin(th3) - 2*nx*ny*cos(th1)^2*cos(th4)*sin(th2)*sin(th3)*sin(th4) - 2*sx*sy*cos(th1)^2*cos(th4)*sin(th2)*sin(th3)*sin(th4) + 2*nx*ny*cos(th4)*sin(th1)^2*sin(th2)*sin(th3)*sin(th4) - 2*nx^2*cos(th1)^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th2)*sin(th3) + 2*sx*sy*cos(th4)*sin(th1)^2*sin(th2)*sin(th3)*sin(th4) - 2*sx^2*cos(th1)^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th2)*sin(th3) - 2*ny^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th1)^2*sin(th2)*sin(th3) - 2*sy^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th1)^2*sin(th2)*sin(th3) + 2*nx*nz*cos(th1)*cos(th2)*cos(th3)^2*cos(th4)^2*sin(th2) + 2*nx*nz*cos(th1)*cos(th2)^2*cos(th3)*cos(th4)^2*sin(th3) + 2*sx*sz*cos(th1)*cos(th2)*cos(th3)^2*cos(th4)^2*sin(th2) + 2*sx*sz*cos(th1)*cos(th2)^2*cos(th3)*cos(th4)^2*sin(th3) - 2*nx*nz*cos(th1)*cos(th2)*cos(th4)^2*sin(th2)*sin(th3)^2 - 2*nx*nz*cos(th1)*cos(th3)*cos(th4)^2*sin(th2)^2*sin(th3) + 2*ny*nz*cos(th2)*cos(th3)^2*cos(th4)^2*sin(th1)*sin(th2) + 2*ny*nz*cos(th2)^2*cos(th3)*cos(th4)^2*sin(th1)*sin(th3) - 2*nx^2*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th4) + 2*ny^2*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th4) - 2*sx*sz*cos(th1)*cos(th2)*cos(th4)^2*sin(th2)*sin(th3)^2 - 2*sx*sz*cos(th1)*cos(th3)*cos(th4)^2*sin(th2)^2*sin(th3) + 2*sy*sz*cos(th2)*cos(th3)^2*cos(th4)^2*sin(th1)*sin(th2) + 2*sy*sz*cos(th2)^2*cos(th3)*cos(th4)^2*sin(th1)*sin(th3) - 2*sx^2*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th4) + 2*sy^2*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th4) - 2*ny*nz*cos(th2)*cos(th4)^2*sin(th1)*sin(th2)*sin(th3)^2 - 2*ny*nz*cos(th3)*cos(th4)^2*sin(th1)*sin(th2)^2*sin(th3) - 2*sy*sz*cos(th2)*cos(th4)^2*sin(th1)*sin(th2)*sin(th3)^2 - 2*sy*sz*cos(th3)*cos(th4)^2*sin(th1)*sin(th2)^2*sin(th3) + 2*nx^2*cos(th1)*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th4) - 2*ny^2*cos(th1)*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th4) + 2*sx^2*cos(th1)*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th4) - 2*sy^2*cos(th1)*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th4) + 2*ny*nz*cos(th1)*cos(th2)*cos(th4)*sin(th3)*sin(th4) + 2*ny*nz*cos(th1)*cos(th3)*cos(th4)*sin(th2)*sin(th4) + 2*sy*sz*cos(th1)*cos(th2)*cos(th4)*sin(th3)*sin(th4) + 2*sy*sz*cos(th1)*cos(th3)*cos(th4)*sin(th2)*sin(th4) + 2*nx*ny*cos(th1)*cos(th2)^2*cos(th3)^2*cos(th4)^2*sin(th1) - 2*nx*nz*cos(th2)*cos(th4)*sin(th1)*sin(th3)*sin(th4) - 2*nx*nz*cos(th3)*cos(th4)*sin(th1)*sin(th2)*sin(th4) + 2*sx*sy*cos(th1)*cos(th2)^2*cos(th3)^2*cos(th4)^2*sin(th1) - 2*sx*sz*cos(th2)*cos(th4)*sin(th1)*sin(th3)*sin(th4) - 2*sx*sz*cos(th3)*cos(th4)*sin(th1)*sin(th2)*sin(th4) + 2*nx*ny*cos(th1)*cos(th4)^2*sin(th1)*sin(th2)^2*sin(th3)^2 + 2*sx*sy*cos(th1)*cos(th4)^2*sin(th1)*sin(th2)^2*sin(th3)^2 + 2*nx*ny*cos(th1)^2*cos(th2)*cos(th3)*cos(th4)*sin(th4) + 2*sx*sy*cos(th1)^2*cos(th2)*cos(th3)*cos(th4)*sin(th4) - 2*nx*ny*cos(th2)*cos(th3)*cos(th4)*sin(th1)^2*sin(th4) - 2*sx*sy*cos(th2)*cos(th3)*cos(th4)*sin(th1)^2*sin(th4) - 4*nx*ny*cos(th1)*cos(th2)*cos(th3)*cos(th4)^2*sin(th1)*sin(th2)*sin(th3) - 4*sx*sy*cos(th1)*cos(th2)*cos(th3)*cos(th4)^2*sin(th1)*sin(th2)*sin(th3))^(1/2))
%  
% q6 =
%  
%      -asin((sy*cos(th1)*sin(th4) - sx*sin(th1)*sin(th4) + sz*cos(th2)*cos(th4)*sin(th3) + sz*cos(th3)*cos(th4)*sin(th2) + sx*cos(th1)*cos(th2)*cos(th3)*cos(th4) + sy*cos(th2)*cos(th3)*cos(th4)*sin(th1) - sx*cos(th1)*cos(th4)*sin(th2)*sin(th3) - sy*cos(th4)*sin(th1)*sin(th2)*sin(th3))/(nx^2*cos(th1)^2*cos(th2)^2*cos(th3)^2*cos(th4)^2 - 2*nx^2*cos(th1)^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th2)*sin(th3) + nx^2*cos(th1)^2*cos(th4)^2*sin(th2)^2*sin(th3)^2 - 2*nx^2*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th4) + 2*nx^2*cos(th1)*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th4) + nx^2*sin(th1)^2*sin(th4)^2 + 2*nx*ny*cos(th1)^2*cos(th2)*cos(th3)*cos(th4)*sin(th4) - 2*nx*ny*cos(th1)^2*cos(th4)*sin(th2)*sin(th3)*sin(th4) + 2*nx*ny*cos(th1)*cos(th2)^2*cos(th3)^2*cos(th4)^2*sin(th1) - 4*nx*ny*cos(th1)*cos(th2)*cos(th3)*cos(th4)^2*sin(th1)*sin(th2)*sin(th3) + 2*nx*ny*cos(th1)*cos(th4)^2*sin(th1)*sin(th2)^2*sin(th3)^2 - 2*nx*ny*cos(th1)*sin(th1)*sin(th4)^2 - 2*nx*ny*cos(th2)*cos(th3)*cos(th4)*sin(th1)^2*sin(th4) + 2*nx*ny*cos(th4)*sin(th1)^2*sin(th2)*sin(th3)*sin(th4) + 2*nx*nz*cos(th1)*cos(th2)^2*cos(th3)*cos(th4)^2*sin(th3) + 2*nx*nz*cos(th1)*cos(th2)*cos(th3)^2*cos(th4)^2*sin(th2) - 2*nx*nz*cos(th1)*cos(th2)*cos(th4)^2*sin(th2)*sin(th3)^2 - 2*nx*nz*cos(th1)*cos(th3)*cos(th4)^2*sin(th2)^2*sin(th3) - 2*nx*nz*cos(th2)*cos(th4)*sin(th1)*sin(th3)*sin(th4) - 2*nx*nz*cos(th3)*cos(th4)*sin(th1)*sin(th2)*sin(th4) + ny^2*cos(th1)^2*sin(th4)^2 + 2*ny^2*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th4) - 2*ny^2*cos(th1)*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th4) + ny^2*cos(th2)^2*cos(th3)^2*cos(th4)^2*sin(th1)^2 - 2*ny^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th1)^2*sin(th2)*sin(th3) + ny^2*cos(th4)^2*sin(th1)^2*sin(th2)^2*sin(th3)^2 + 2*ny*nz*cos(th1)*cos(th2)*cos(th4)*sin(th3)*sin(th4) + 2*ny*nz*cos(th1)*cos(th3)*cos(th4)*sin(th2)*sin(th4) + 2*ny*nz*cos(th2)^2*cos(th3)*cos(th4)^2*sin(th1)*sin(th3) + 2*ny*nz*cos(th2)*cos(th3)^2*cos(th4)^2*sin(th1)*sin(th2) - 2*ny*nz*cos(th2)*cos(th4)^2*sin(th1)*sin(th2)*sin(th3)^2 - 2*ny*nz*cos(th3)*cos(th4)^2*sin(th1)*sin(th2)^2*sin(th3) + nz^2*cos(th2)^2*cos(th4)^2*sin(th3)^2 + 2*nz^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th2)*sin(th3) + nz^2*cos(th3)^2*cos(th4)^2*sin(th2)^2 + sx^2*cos(th1)^2*cos(th2)^2*cos(th3)^2*cos(th4)^2 - 2*sx^2*cos(th1)^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th2)*sin(th3) + sx^2*cos(th1)^2*cos(th4)^2*sin(th2)^2*sin(th3)^2 - 2*sx^2*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th4) + 2*sx^2*cos(th1)*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th4) + sx^2*sin(th1)^2*sin(th4)^2 + 2*sx*sy*cos(th1)^2*cos(th2)*cos(th3)*cos(th4)*sin(th4) - 2*sx*sy*cos(th1)^2*cos(th4)*sin(th2)*sin(th3)*sin(th4) + 2*sx*sy*cos(th1)*cos(th2)^2*cos(th3)^2*cos(th4)^2*sin(th1) - 4*sx*sy*cos(th1)*cos(th2)*cos(th3)*cos(th4)^2*sin(th1)*sin(th2)*sin(th3) + 2*sx*sy*cos(th1)*cos(th4)^2*sin(th1)*sin(th2)^2*sin(th3)^2 - 2*sx*sy*cos(th1)*sin(th1)*sin(th4)^2 - 2*sx*sy*cos(th2)*cos(th3)*cos(th4)*sin(th1)^2*sin(th4) + 2*sx*sy*cos(th4)*sin(th1)^2*sin(th2)*sin(th3)*sin(th4) + 2*sx*sz*cos(th1)*cos(th2)^2*cos(th3)*cos(th4)^2*sin(th3) + 2*sx*sz*cos(th1)*cos(th2)*cos(th3)^2*cos(th4)^2*sin(th2) - 2*sx*sz*cos(th1)*cos(th2)*cos(th4)^2*sin(th2)*sin(th3)^2 - 2*sx*sz*cos(th1)*cos(th3)*cos(th4)^2*sin(th2)^2*sin(th3) - 2*sx*sz*cos(th2)*cos(th4)*sin(th1)*sin(th3)*sin(th4) - 2*sx*sz*cos(th3)*cos(th4)*sin(th1)*sin(th2)*sin(th4) + sy^2*cos(th1)^2*sin(th4)^2 + 2*sy^2*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th4) - 2*sy^2*cos(th1)*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th4) + sy^2*cos(th2)^2*cos(th3)^2*cos(th4)^2*sin(th1)^2 - 2*sy^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th1)^2*sin(th2)*sin(th3) + sy^2*cos(th4)^2*sin(th1)^2*sin(th2)^2*sin(th3)^2 + 2*sy*sz*cos(th1)*cos(th2)*cos(th4)*sin(th3)*sin(th4) + 2*sy*sz*cos(th1)*cos(th3)*cos(th4)*sin(th2)*sin(th4) + 2*sy*sz*cos(th2)^2*cos(th3)*cos(th4)^2*sin(th1)*sin(th3) + 2*sy*sz*cos(th2)*cos(th3)^2*cos(th4)^2*sin(th1)*sin(th2) - 2*sy*sz*cos(th2)*cos(th4)^2*sin(th1)*sin(th2)*sin(th3)^2 - 2*sy*sz*cos(th3)*cos(th4)^2*sin(th1)*sin(th2)^2*sin(th3) + sz^2*cos(th2)^2*cos(th4)^2*sin(th3)^2 + 2*sz^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th2)*sin(th3) + sz^2*cos(th3)^2*cos(th4)^2*sin(th2)^2)^(1/2))
%  pi + asin((sy*cos(th1)*sin(th4) - sx*sin(th1)*sin(th4) + sz*cos(th2)*cos(th4)*sin(th3) + sz*cos(th3)*cos(th4)*sin(th2) + sx*cos(th1)*cos(th2)*cos(th3)*cos(th4) + sy*cos(th2)*cos(th3)*cos(th4)*sin(th1) - sx*cos(th1)*cos(th4)*sin(th2)*sin(th3) - sy*cos(th4)*sin(th1)*sin(th2)*sin(th3))/(nx^2*cos(th1)^2*cos(th2)^2*cos(th3)^2*cos(th4)^2 - 2*nx^2*cos(th1)^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th2)*sin(th3) + nx^2*cos(th1)^2*cos(th4)^2*sin(th2)^2*sin(th3)^2 - 2*nx^2*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th4) + 2*nx^2*cos(th1)*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th4) + nx^2*sin(th1)^2*sin(th4)^2 + 2*nx*ny*cos(th1)^2*cos(th2)*cos(th3)*cos(th4)*sin(th4) - 2*nx*ny*cos(th1)^2*cos(th4)*sin(th2)*sin(th3)*sin(th4) + 2*nx*ny*cos(th1)*cos(th2)^2*cos(th3)^2*cos(th4)^2*sin(th1) - 4*nx*ny*cos(th1)*cos(th2)*cos(th3)*cos(th4)^2*sin(th1)*sin(th2)*sin(th3) + 2*nx*ny*cos(th1)*cos(th4)^2*sin(th1)*sin(th2)^2*sin(th3)^2 - 2*nx*ny*cos(th1)*sin(th1)*sin(th4)^2 - 2*nx*ny*cos(th2)*cos(th3)*cos(th4)*sin(th1)^2*sin(th4) + 2*nx*ny*cos(th4)*sin(th1)^2*sin(th2)*sin(th3)*sin(th4) + 2*nx*nz*cos(th1)*cos(th2)^2*cos(th3)*cos(th4)^2*sin(th3) + 2*nx*nz*cos(th1)*cos(th2)*cos(th3)^2*cos(th4)^2*sin(th2) - 2*nx*nz*cos(th1)*cos(th2)*cos(th4)^2*sin(th2)*sin(th3)^2 - 2*nx*nz*cos(th1)*cos(th3)*cos(th4)^2*sin(th2)^2*sin(th3) - 2*nx*nz*cos(th2)*cos(th4)*sin(th1)*sin(th3)*sin(th4) - 2*nx*nz*cos(th3)*cos(th4)*sin(th1)*sin(th2)*sin(th4) + ny^2*cos(th1)^2*sin(th4)^2 + 2*ny^2*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th4) - 2*ny^2*cos(th1)*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th4) + ny^2*cos(th2)^2*cos(th3)^2*cos(th4)^2*sin(th1)^2 - 2*ny^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th1)^2*sin(th2)*sin(th3) + ny^2*cos(th4)^2*sin(th1)^2*sin(th2)^2*sin(th3)^2 + 2*ny*nz*cos(th1)*cos(th2)*cos(th4)*sin(th3)*sin(th4) + 2*ny*nz*cos(th1)*cos(th3)*cos(th4)*sin(th2)*sin(th4) + 2*ny*nz*cos(th2)^2*cos(th3)*cos(th4)^2*sin(th1)*sin(th3) + 2*ny*nz*cos(th2)*cos(th3)^2*cos(th4)^2*sin(th1)*sin(th2) - 2*ny*nz*cos(th2)*cos(th4)^2*sin(th1)*sin(th2)*sin(th3)^2 - 2*ny*nz*cos(th3)*cos(th4)^2*sin(th1)*sin(th2)^2*sin(th3) + nz^2*cos(th2)^2*cos(th4)^2*sin(th3)^2 + 2*nz^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th2)*sin(th3) + nz^2*cos(th3)^2*cos(th4)^2*sin(th2)^2 + sx^2*cos(th1)^2*cos(th2)^2*cos(th3)^2*cos(th4)^2 - 2*sx^2*cos(th1)^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th2)*sin(th3) + sx^2*cos(th1)^2*cos(th4)^2*sin(th2)^2*sin(th3)^2 - 2*sx^2*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th4) + 2*sx^2*cos(th1)*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th4) + sx^2*sin(th1)^2*sin(th4)^2 + 2*sx*sy*cos(th1)^2*cos(th2)*cos(th3)*cos(th4)*sin(th4) - 2*sx*sy*cos(th1)^2*cos(th4)*sin(th2)*sin(th3)*sin(th4) + 2*sx*sy*cos(th1)*cos(th2)^2*cos(th3)^2*cos(th4)^2*sin(th1) - 4*sx*sy*cos(th1)*cos(th2)*cos(th3)*cos(th4)^2*sin(th1)*sin(th2)*sin(th3) + 2*sx*sy*cos(th1)*cos(th4)^2*sin(th1)*sin(th2)^2*sin(th3)^2 - 2*sx*sy*cos(th1)*sin(th1)*sin(th4)^2 - 2*sx*sy*cos(th2)*cos(th3)*cos(th4)*sin(th1)^2*sin(th4) + 2*sx*sy*cos(th4)*sin(th1)^2*sin(th2)*sin(th3)*sin(th4) + 2*sx*sz*cos(th1)*cos(th2)^2*cos(th3)*cos(th4)^2*sin(th3) + 2*sx*sz*cos(th1)*cos(th2)*cos(th3)^2*cos(th4)^2*sin(th2) - 2*sx*sz*cos(th1)*cos(th2)*cos(th4)^2*sin(th2)*sin(th3)^2 - 2*sx*sz*cos(th1)*cos(th3)*cos(th4)^2*sin(th2)^2*sin(th3) - 2*sx*sz*cos(th2)*cos(th4)*sin(th1)*sin(th3)*sin(th4) - 2*sx*sz*cos(th3)*cos(th4)*sin(th1)*sin(th2)*sin(th4) + sy^2*cos(th1)^2*sin(th4)^2 + 2*sy^2*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th4) - 2*sy^2*cos(th1)*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th4) + sy^2*cos(th2)^2*cos(th3)^2*cos(th4)^2*sin(th1)^2 - 2*sy^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th1)^2*sin(th2)*sin(th3) + sy^2*cos(th4)^2*sin(th1)^2*sin(th2)^2*sin(th3)^2 + 2*sy*sz*cos(th1)*cos(th2)*cos(th4)*sin(th3)*sin(th4) + 2*sy*sz*cos(th1)*cos(th3)*cos(th4)*sin(th2)*sin(th4) + 2*sy*sz*cos(th2)^2*cos(th3)*cos(th4)^2*sin(th1)*sin(th3) + 2*sy*sz*cos(th2)*cos(th3)^2*cos(th4)^2*sin(th1)*sin(th2) - 2*sy*sz*cos(th2)*cos(th4)^2*sin(th1)*sin(th2)*sin(th3)^2 - 2*sy*sz*cos(th3)*cos(th4)^2*sin(th1)*sin(th2)^2*sin(th3) + sz^2*cos(th2)^2*cos(th4)^2*sin(th3)^2 + 2*sz^2*cos(th2)*cos(th3)*cos(th4)^2*sin(th2)*sin(th3) + sz^2*cos(th3)^2*cos(th4)^2*sin(th2)^2)^(1/2))

% x
% L2*cos(th1)*cos(th2) - L4*sin(th2 + th3)*cos(th1) - L3*sin(th1) - L5*sin(th2 + th3)*cos(th1)*cos(th5) + L5*sin(th1)*sin(th4)*sin(th5) + L5*cos(th1)*cos(th4)*sin(th2)*sin(th3)*sin(th5) - L5*cos(th1)*cos(th2)*cos(th3)*cos(th4)*sin(th5)
% y
% L3*cos(th1) - L4*sin(th2 + th3)*sin(th1) + L2*cos(th2)*sin(th1) - L5*sin(th2 + th3)*cos(th5)*sin(th1) - L5*cos(th1)*sin(th4)*sin(th5) - L5*cos(th2)*cos(th3)*cos(th4)*sin(th1)*sin(th5) + L5*cos(th4)*sin(th1)*sin(th2)*sin(th3)*sin(th5)
% z
% L1 + L4*cos(th2 + th3) + L2*sin(th2) - (L5*sin(th2 + th3)*sin(th4 + th5))/2 + L5*cos(th2 + th3)*cos(th5) + (L5*sin(th4 - th5)*sin(th2 + th3))/2
